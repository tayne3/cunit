cmake_minimum_required(VERSION 3.14)

include(${CMAKE_CURRENT_LIST_DIR}/cmake/PreventInSourceBuilds.cmake)
include(${CMAKE_CURRENT_LIST_DIR}/cmake/GitVersion.cmake)
gitversion_extract(VERSION PROJECT_VERSION DEFAULT_VERSION 0.2.3)
project(cunit VERSION ${PROJECT_VERSION})

include(${CMAKE_CURRENT_LIST_DIR}/cmake/ProjectIsTopLevel.cmake)
include(${CMAKE_CURRENT_LIST_DIR}/cmake/OptionVariables.cmake)
include(${CMAKE_CURRENT_LIST_DIR}/cmake/ProjectConfig.cmake)

if(CUNIT_BUILD_SHARED)
  add_library(cunit_shared SHARED)
  set(CUNIT cunit_shared)
  message(STATUS "cunit v${PROJECT_VERSION} shared library")
else()
  add_library(cunit_static STATIC)
  set(CUNIT cunit_static)
  message(STATUS "cunit v${PROJECT_VERSION} static library")
endif()
add_library(cunit::cunit ALIAS ${CUNIT})

file(GLOB_RECURSE project_source_files CONFIGURE_DEPENDS src/*.c)
target_sources(${CUNIT} PUBLIC ${project_source_files})
target_link_libraries(${CUNIT} PUBLIC ${PROJECT_NAME}_compile_dependency)
target_include_directories(${CUNIT} PUBLIC ${CMAKE_CURRENT_SOURCE_DIR}/include)

if(CUNIT_BUILD_EXAMPLE)
    enable_testing()
    add_subdirectory(example)
endif()
